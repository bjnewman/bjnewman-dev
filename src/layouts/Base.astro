---
import { ViewTransitions } from 'astro:transitions';
import SecretFeatures from '../SecretFeatures';
import '../styles/theme.css';
import '../styles/components.css';
import '../styles/secret-menu.css';

interface Props {
  title?: string;
  description?: string;
}

const {
  title,
  description = "Software engineer and technology enthusiast. Building modern web applications with React, TypeScript, and Astro."
} = Astro.props;

const pageTitle = title ? `${title} — Ben Newman` : 'Ben Newman';
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const currentPath = Astro.url.pathname;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <!-- Primary Meta Tags -->
    <title>{pageTitle}</title>
    <meta name="title" content={pageTitle}>
    <meta name="description" content={description}>
    <meta name="author" content="Ben Newman">
    <link rel="canonical" href={canonicalURL}>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content={canonicalURL}>
    <meta property="og:title" content={pageTitle}>
    <meta property="og:description" content={description}>
    <meta property="og:site_name" content="Ben Newman">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary">
    <meta property="twitter:url" content={canonicalURL}>
    <meta property="twitter:title" content={pageTitle}>
    <meta property="twitter:description" content={description}>

    <!-- Fonts with optimized loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Nunito:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- RSS Feed -->
    <link rel="alternate" type="application/rss+xml" title="Ben Newman's Blog" href="/rss.xml">

    <!-- View Transitions -->
    <ViewTransitions />

    <!-- Prevent FOUC by applying saved theme before render -->
    <script is:inline>
      (function() {
        const savedThemeId = localStorage.getItem('bjnewman-theme');
        if (savedThemeId) {
          const themes = {
            'professional': { primary: '#6366f1', primaryLight: '#818cf8', primaryDark: '#4f46e5', accent: '#ec4899', accentLight: '#f472b6', textPrimary: '#1e293b', textSecondary: '#64748b', textMuted: '#94a3b8', bgGradient: 'linear-gradient(135deg, #f8fafc 0%, #e0e7ff 50%, #fce7f3 100%)', bgPrimary: '#ffffff', bgSecondary: '#f8fafc', bgTertiary: '#f1f5f9' },
            'sunset': { primary: '#f97316', primaryLight: '#fb923c', primaryDark: '#ea580c', accent: '#f59e0b', accentLight: '#fbbf24', textPrimary: '#1e293b', textSecondary: '#64748b', textMuted: '#94a3b8', bgGradient: 'linear-gradient(135deg, #fef3c7 0%, #fed7aa 50%, #fecaca 100%)', bgPrimary: '#ffffff', bgSecondary: '#f8fafc', bgTertiary: '#f1f5f9' },
            'ocean': { primary: '#0ea5e9', primaryLight: '#38bdf8', primaryDark: '#0284c7', accent: '#06b6d4', accentLight: '#22d3ee', textPrimary: '#1e293b', textSecondary: '#64748b', textMuted: '#94a3b8', bgGradient: 'linear-gradient(135deg, #e0f2fe 0%, #bae6fd 50%, #ddd6fe 100%)', bgPrimary: '#ffffff', bgSecondary: '#f8fafc', bgTertiary: '#f1f5f9' },
            'forest': { primary: '#10b981', primaryLight: '#34d399', primaryDark: '#059669', accent: '#14b8a6', accentLight: '#2dd4bf', textPrimary: '#1e293b', textSecondary: '#64748b', textMuted: '#94a3b8', bgGradient: 'linear-gradient(135deg, #d1fae5 0%, #a7f3d0 50%, #bfdbfe 100%)', bgPrimary: '#ffffff', bgSecondary: '#f8fafc', bgTertiary: '#f1f5f9' },
            'dark': { primary: '#818cf8', primaryLight: '#a5b4fc', primaryDark: '#6366f1', accent: '#f472b6', accentLight: '#f9a8d4', textPrimary: '#f1f5f9', textSecondary: '#cbd5e1', textMuted: '#94a3b8', bgGradient: 'linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%)', bgPrimary: '#1e293b', bgSecondary: '#334155', bgTertiary: '#475569' },
            'pastel': { primary: '#E6D1FF', primaryLight: '#F5E6FF', primaryDark: '#D1B3FF', accent: '#FFD1DC', accentLight: '#FFE6ED', textPrimary: '#4A4A4A', textSecondary: '#757575', textMuted: '#999999', bgGradient: 'linear-gradient(135deg, #BFDFFF 0%, #FFD1DC 100%)', bgPrimary: '#ffffff', bgSecondary: '#f8fafc', bgTertiary: '#f1f5f9' }
          };
          const theme = themes[savedThemeId];
          if (theme) {
            const root = document.documentElement;
            root.style.setProperty('--primary', theme.primary);
            root.style.setProperty('--primary-light', theme.primaryLight);
            root.style.setProperty('--primary-dark', theme.primaryDark);
            root.style.setProperty('--accent', theme.accent);
            root.style.setProperty('--accent-light', theme.accentLight);
            root.style.setProperty('--text-primary', theme.textPrimary);
            root.style.setProperty('--text-secondary', theme.textSecondary);
            root.style.setProperty('--text-muted', theme.textMuted);
            root.style.setProperty('--bg-primary', theme.bgPrimary);
            root.style.setProperty('--bg-secondary', theme.bgSecondary);
            root.style.setProperty('--bg-tertiary', theme.bgTertiary);
            document.body.style.background = theme.bgGradient;
            document.body.style.backgroundAttachment = 'fixed';
          }
        }
      })();
    </script>
  </head>
  <body>
    <!-- Skip to main content link for keyboard navigation -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header role="banner">
      <nav role="navigation" aria-label="Main navigation">
        <a href="/" class={currentPath === '/' ? 'active' : ''}>Home</a>
        <a href="/about" class={currentPath.startsWith('/about') ? 'active' : ''}>About</a>
        <a href="/projects" class={currentPath.startsWith('/projects') ? 'active' : ''}>Projects</a>
        <a href="/resume" class={currentPath.startsWith('/resume') ? 'active' : ''}>Resume</a>
        <a href="/blog" class={currentPath.startsWith('/blog') ? 'active' : ''}>Blog</a>
      </nav>
    </header>

    <main id="main-content" role="main">
      <slot />
    </main>

    <footer role="contentinfo">
      <div class="social-links">
        <a href="https://github.com/bjnewman" target="_blank" rel="noopener noreferrer" aria-label="GitHub profile">GitHub</a>
        <a href="https://gitlab.com/bjnewman" target="_blank" rel="noopener noreferrer" aria-label="GitLab profile">GitLab</a>
        <a href="https://linkedin.com/in/bjnewman" target="_blank" rel="noopener noreferrer" aria-label="LinkedIn profile">LinkedIn</a>
        <a href="/rss.xml" aria-label="RSS feed">RSS</a>
      </div>
      <p>© 2026 Ben Newman</p>
    </footer>
    <SecretFeatures client:load />
  </body>
</html>
